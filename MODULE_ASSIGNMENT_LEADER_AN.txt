PHÂN CHIA MODULE DỰ ÁN COOKSHARE - PHẦN 1
==========================================
LEADER VÀ AN

THÔNG TIN CHUNG
---------------
Dự án: CookShare - Ứng dụng chia sẻ công thức nấu ăn
Người phụ trách: Leader (gánh nhiều nhất) và An

CÁCH ĐỌC TÀI LIỆU NÀY
----------------------
- Đọc hết phần module của mình trước
- Xem danh sách file cần làm việc
- Đọc luồng xử lý để hiểu cách code hoạt động
- Review code hiện tại để hiểu cấu trúc
- Nếu có thắc mắc, hỏi leader trước khi code

QUY TRÌNH LÀM VIỆC
------------------
1. Đọc module assignment của mình
2. Review code hiện tại trong module đó
3. Hiểu luồng xử lý (flow) của module
4. Code theo yêu cầu
5. Test kỹ trước khi commit
6. Code review với leader trước khi merge

==========================================
MODULE 1: CHATBOT, MESSAGES, NOTIFICATIONS, VIDEO
==========================================
NGƯỜI PHỤ TRÁCH: LEADER
ĐỘ PHỨC TẠP: CAO NHẤT

CHATBOT MODULE
--------------
Mục đích: AI tư vấn món ăn, nhận diện nguyên liệu từ ảnh, gợi ý theo chế độ ăn

File Backend cần làm việc:
- backend/src/controllers/chatbotController.js
- backend/src/routes/chatbotRoutes.js
- backend/src/models/ (nếu cần model riêng)

File Frontend cần làm việc:
- app/(tabs)/chatbot.tsx
- components/chatbot/ (nếu có)

API Endpoints cần xử lý:
- POST /api/chatbot/message - Gửi tin nhắn text
- POST /api/chatbot/message-with-image - Gửi tin nhắn kèm ảnh
- GET /api/chatbot/check-apikey - Kiểm tra API key

Luồng xử lý Chatbot:
1. User nhập tin nhắn hoặc chụp ảnh
2. Frontend gửi request đến backend
3. Backend xử lý:
   - Nếu có ảnh: Gọi OpenAI Vision API để nhận diện nguyên liệu
   - Nếu chỉ có text: Gọi OpenAI Chat API để tư vấn
   - Xử lý context: Lấy lịch sử chat, thông tin user, thời tiết
4. Backend trả về response từ AI
5. Frontend hiển thị response cho user
6. Nếu user chọn thêm món vào lịch: Gọi API meal planning

Nhiệm vụ cụ thể:
- Kiểm tra và xử lý lỗi API (429, 401, timeout)
- Tối ưu prompt để giảm token usage
- Xử lý context chat (lưu lịch sử, nhớ thông tin user)
- Tích hợp YouTube API để lấy video hướng dẫn
- Xử lý ảnh upload (multer, storage)
- Hiển thị loading state, error state

MESSAGES MODULE
---------------
Mục đích: Nhắn tin trực tiếp giữa các user, gửi ảnh, gửi voice

File Backend cần làm việc:
- backend/src/controllers/messageController.js
- backend/src/routes/messageRoutes.js
- backend/src/models/Message.js (nếu có)

File Frontend cần làm việc:
- app/messages/index.tsx - Danh sách conversations
- app/messages/[partnerId].tsx - Màn hình chat với 1 người

API Endpoints cần xử lý:
- POST /api/messages/send - Gửi tin nhắn (có thể kèm ảnh, voice)
- GET /api/messages/conversations - Lấy danh sách conversations
- GET /api/messages/conversation/:partnerId - Lấy tin nhắn với 1 người
- GET /api/messages/unread-count - Đếm số tin nhắn chưa đọc
- PUT /api/messages/:messageId/reaction - Thêm/xóa cảm xúc
- DELETE /api/messages/:messageId - Xóa tin nhắn (thu hồi)
- DELETE /api/messages/conversation/:partnerId - Xóa toàn bộ cuộc trò chuyện

Luồng xử lý Messages:
1. User chọn người để nhắn tin từ danh sách conversations
2. Frontend load tin nhắn cũ (pagination)
3. User gõ tin nhắn mới:
   - Nếu có ảnh/voice: Upload file trước
   - Gửi request POST /api/messages/send
4. Backend lưu tin nhắn vào database
5. Backend tạo notification cho người nhận
6. Frontend hiển thị tin nhắn mới ngay lập tức (real-time nếu có)
7. Khi người nhận mở app: Cập nhật unread count, hiển thị badge

Nhiệm vụ cụ thể:
- Upload file (ảnh, voice) với multer
- Real-time messaging (WebSocket hoặc polling)
- Unread count tracking
- Reaction (like, love, etc.)
- Xóa tin nhắn (soft delete hoặc hard delete)
- Pagination cho tin nhắn cũ
- Hiển thị avatar, tên người gửi
- Tìm kiếm trong conversations

NOTIFICATIONS MODULE
--------------------
Mục đích: Thông báo cho user về like, comment, follow, message, challenge

File Backend cần làm việc:
- backend/src/controllers/notificationController.js
- backend/src/routes/notificationRoutes.js
- backend/src/models/Notification.js
- backend/src/utils/notificationHelper.js

File Frontend cần làm việc:
- app/notifications.tsx

API Endpoints cần xử lý:
- GET /api/notifications - Lấy danh sách notifications
- GET /api/notifications/unread-count - Lấy số notifications chưa đọc
- PUT /api/notifications/:notificationId/read - Đánh dấu đã đọc
- PUT /api/notifications/read-all - Đánh dấu tất cả đã đọc
- DELETE /api/notifications/:notificationId - Xóa notification
- DELETE /api/notifications/read - Xóa tất cả notifications đã đọc
- POST /api/notifications/push-token - Lưu push token

Luồng xử lý Notifications:
1. Khi có sự kiện (like, comment, follow, message):
   - Controller tương ứng gọi notificationHelper
   - Tạo notification trong database
   - Nếu có push token: Gửi push notification
2. User mở app: Frontend load notifications
3. User click vào notification: Chuyển đến màn hình liên quan, đánh dấu đã đọc
4. User có thể xóa notification hoặc đánh dấu tất cả đã đọc

Nhiệm vụ cụ thể:
- Tạo notification khi có like, comment, follow, message, challenge
- Push notification (Expo Notifications)
- Unread count badge
- Đánh dấu đã đọc (mark as read)
- Xóa notification
- Hiển thị avatar người thực hiện hành động
- Phân loại notification (like, comment, follow, etc.)
- Link notification đến màn hình đúng (recipe detail, profile, etc.)

VIDEO MODULE
------------
Mục đích: Upload video hướng dẫn nấu ăn, xem video từ user khác

File Backend cần làm việc:
- backend/src/controllers/videoController.js (tạo mới)
- backend/src/routes/videoRoutes.js (tạo mới)
- backend/src/models/Video.js (tạo mới)
- backend/src/middleware/upload.js (thêm video upload)

File Frontend cần làm việc:
- app/video/upload.tsx - Màn hình upload video
- app/video/[videoId].tsx - Màn hình xem video
- app/video/my-videos.tsx - Danh sách video của tôi
- components/video/VideoPlayer.tsx - Component phát video

API Endpoints cần xử lý:
- POST /api/videos/upload - Upload video mới
- GET /api/videos - Lấy danh sách video (có filter, search)
- GET /api/videos/:videoId - Lấy chi tiết video
- PUT /api/videos/:videoId - Cập nhật thông tin video
- DELETE /api/videos/:videoId - Xóa video
- POST /api/videos/:videoId/like - Like/Unlike video
- POST /api/videos/:videoId/view - Đánh dấu đã xem (tăng view count)
- GET /api/videos/user/:userId - Lấy video của 1 user
- GET /api/videos/trending - Lấy video trending

Luồng xử lý Video:
1. Upload video:
   - User chọn video từ thư viện hoặc quay video
   - Frontend hiển thị preview
   - User nhập thông tin (tiêu đề, mô tả, công thức liên quan)
   - Frontend upload video lên server (có thể dùng multipart upload cho video lớn)
   - Backend lưu video vào storage (local hoặc cloud)
   - Backend tạo record trong database
   - Backend có thể xử lý video (tạo thumbnail, compress)
2. Xem video:
   - User chọn video từ danh sách
   - Frontend load thông tin video
   - Frontend phát video (dùng Video component của Expo)
   - Backend tăng view count
   - User có thể like, comment video
3. Quản lý video:
   - User xem danh sách video của mình
   - User có thể chỉnh sửa, xóa video

Nhiệm vụ cụ thể:
- Upload video (multer, xử lý file lớn)
- Lưu video vào storage (local hoặc cloud)
- Tạo thumbnail từ video
- Compress video (nếu cần)
- Phát video trong app (Expo AV)
- View count tracking
- Like/Unlike video
- Comment video (có thể tái sử dụng comment system từ recipes)
- Tìm kiếm video (theo tiêu đề, mô tả)
- Filter video (theo user, theo công thức)
- Trending videos (video được xem nhiều nhất)
- Pagination cho danh sách video
- Hiển thị avatar, tên người đăng
- Link video với công thức (nếu có)

Lưu ý kỹ thuật:
- Video file thường lớn, cần xử lý upload với progress bar
- Có thể cần streaming cho video lớn
- Cần xử lý format video (mp4, mov, etc.)
- Cần xử lý orientation (portrait, landscape)
- Cần tối ưu bandwidth (chỉ load video khi user scroll đến)

==========================================
MODULE 4: AUTH, PROFILE, MEAL PLANNING, ACHIEVEMENTS
==========================================
NGƯỜI PHỤ TRÁCH: AN
ĐỘ PHỨC TẠP: TRUNG BÌNH

AUTHENTICATION MODULE
---------------------
Mục đích: Đăng ký, đăng nhập, quên mật khẩu, đổi mật khẩu

File Backend cần làm việc:
- backend/src/controllers/authController.js
- backend/src/routes/authRoutes.js
- backend/src/middleware/auth.js

File Frontend cần làm việc:
- app/login.tsx
- app/register.tsx
- app/onboarding.tsx (nếu có)

API Endpoints cần xử lý:
- POST /api/auth/register - Đăng ký tài khoản
- POST /api/auth/login - Đăng nhập
- POST /api/auth/forgot-password - Quên mật khẩu
- POST /api/auth/reset-password - Đặt lại mật khẩu

Luồng xử lý Authentication:
1. Đăng ký:
   - User nhập thông tin (email, password, name)
   - Validate thông tin
   - Mã hóa password
   - Tạo user trong database
   - Trả về JWT token
2. Đăng nhập:
   - User nhập email, password
   - Kiểm tra thông tin
   - Trả về JWT token
3. Quên mật khẩu:
   - User nhập email
   - Gửi email reset password (nếu có)
   - Hoặc trả về reset token
4. Đặt lại mật khẩu:
   - User nhập reset token, mật khẩu mới
   - Cập nhật mật khẩu trong database

Nhiệm vụ cụ thể:
- Đăng ký tài khoản (validate email, password)
- Đăng nhập (JWT token)
- Quên mật khẩu (reset token)
- Đặt lại mật khẩu
- Validate input (email format, password strength)
- Error handling (email đã tồn tại, sai mật khẩu)
- Lưu token trong SecureStore (frontend)

PROFILE MODULE
--------------
Mục đích: Quản lý thông tin cá nhân, xem profile người khác, follow/unfollow

File Backend cần làm việc:
- backend/src/controllers/userController.js
- backend/src/routes/userRoutes.js
- backend/src/models/User.js

File Frontend cần làm việc:
- app/(tabs)/profile.tsx - Profile của tôi
- app/user/[userId].tsx - Profile người khác

API Endpoints cần xử lý:
- GET /api/user/profile - Lấy thông tin profile
- PUT /api/user/profile - Cập nhật thông tin profile
- POST /api/user/avatar - Upload avatar
- POST /api/user/change-password - Đổi mật khẩu
- GET /api/user/:userId - Lấy thông tin user theo ID
- POST /api/user/:userId/follow - Follow/Unfollow user
- GET /api/user/followers - Lấy danh sách followers
- GET /api/user/following - Lấy danh sách following
- GET /api/user/chefs - Lấy danh sách tất cả chefs

Luồng xử lý Profile:
1. Profile của tôi:
   - Hiển thị thông tin (tên, email, avatar, level, điểm)
   - Cho phép chỉnh sửa thông tin
   - Upload avatar
   - Đổi mật khẩu
   - Xem công thức của tôi
   - Xem công thức đã lưu
   - Xem followers, following
2. Profile người khác:
   - Hiển thị thông tin (tên, avatar, level, điểm)
   - Follow/Unfollow
   - Xem công thức của họ
   - Xem followers, following của họ

Nhiệm vụ cụ thể:
- Hiển thị thông tin profile
- Cập nhật thông tin (tên, bio, etc.)
- Upload avatar (multer, storage)
- Đổi mật khẩu
- Follow/Unfollow user
- Hiển thị followers, following
- Hiển thị level, điểm, badges
- Hiển thị số công thức, số like
- Link đến công thức của user

MEAL PLANNING MODULE
--------------------
Mục đích: Lập kế hoạch bữa ăn theo tuần, thêm món vào lịch, nhận nhắc bữa ăn

File Backend cần làm việc:
- backend/src/controllers/mealPlanningController.js
- backend/src/routes/mealPlanningRoutes.js
- backend/src/models/MealPlan.js

File Frontend cần làm việc:
- app/(tabs)/meal-planning.tsx - Màn hình lịch ăn
- app/meal-planning.tsx (nếu có màn hình chi tiết)

API Endpoints cần xử lý:
- GET /api/meal-planning/week - Lấy kế hoạch bữa ăn theo tuần
- POST /api/meal-planning/generate-week - AI tự động tạo kế hoạch tuần
- POST /api/meal-planning/add - Thêm món vào lịch
- PUT /api/meal-planning/update - Cập nhật món trong lịch
- DELETE /api/meal-planning/delete - Xóa món khỏi lịch

Luồng xử lý Meal Planning:
1. Hiển thị lịch ăn theo tuần (7 ngày, 3 bữa: sáng, trưa, tối)
2. User có thể:
   - Thêm món vào lịch (chọn ngày, bữa, công thức)
   - Cập nhật món trong lịch
   - Xóa món khỏi lịch
   - Dùng AI để tự động tạo kế hoạch tuần
3. Nhận nhắc bữa ăn (push notification)
4. Đánh dấu món đã nấu (tích hợp với achievements)

Nhiệm vụ cụ thể:
- Hiển thị lịch ăn theo tuần (calendar view)
- Thêm món vào lịch (chọn ngày, bữa, công thức)
- Cập nhật món trong lịch
- Xóa món khỏi lịch
- AI generate kế hoạch tuần (tích hợp chatbot)
- Push notification nhắc nhở bữa ăn
- Đánh dấu món đã nấu (tích hợp achievements)
- Hiển thị công thức trong lịch

ACHIEVEMENTS MODULE
-------------------
Mục đích: Hệ thống thành tích, điểm, level, badges, leaderboard

File Backend cần làm việc:
- backend/src/controllers/achievementController.js
- backend/src/routes/achievementRoutes.js
- backend/src/models/Achievement.js

File Frontend cần làm việc:
- app/(tabs)/profile.tsx (phần achievements)

API Endpoints cần xử lý:
- GET /api/achievements - Lấy thành tích của user
- GET /api/achievements/badges - Lấy danh sách badges
- POST /api/achievements/streak - Cập nhật streak (chuỗi ngày nấu ăn)
- GET /api/achievements/stats - Thống kê tổng quan
- POST /api/achievements/mark-meal-cooked - Đánh dấu món đã nấu (nhận điểm)
- GET /api/achievements/leaderboard - Bảng xếp hạng

Luồng xử lý Achievements:
1. User nhận điểm khi:
   - Đánh dấu món đã nấu
   - Hoàn thành challenge
   - Tạo công thức mới
   - Nhận like, comment
2. Khi đủ điểm: Lên level
3. Khi đạt điều kiện: Nhận badge
4. Hiển thị leaderboard (top users)

Nhiệm vụ cụ thể:
- Tính điểm (XP) cho user
- Lên level khi đủ điểm
- Cập nhật streak (chuỗi ngày nấu ăn liên tiếp)
- Badges (huy hiệu) khi đạt điều kiện
- Đánh dấu món đã nấu (nhận điểm)
- Thống kê (tổng điểm, level, streak, badges)
- Leaderboard (top users theo điểm)
- Hiển thị thành tích trong profile

==========================================
LƯU Ý CHUNG CHO TẤT CẢ MODULE
==========================================

BACKEND
-------
- Tất cả API phải có authentication (trừ login, register)
- Validate input trước khi xử lý
- Error handling đầy đủ (try-catch, trả về message rõ ràng)
- Format response nhất quán: { success: true/false, data: ..., message: ... }
- Upload file: Dùng multer, lưu vào storage (local hoặc cloud)
- Format URL: Dùng getFileUrlFromStorage để format URL ảnh
- Database: Dùng MongoDB, aggregation pipeline khi cần
- Pagination: Dùng limit, skip cho danh sách

FRONTEND
--------
- Loading state: Hiển thị loading khi đang fetch data
- Error state: Hiển thị lỗi rõ ràng cho user
- Empty state: Hiển thị khi không có dữ liệu
- Pull to refresh: Cho danh sách
- Pagination: Load more hoặc infinite scroll
- Avatar: Hiển thị placeholder nếu không có avatar
- Navigation: Dùng Expo Router để navigate
- State management: Dùng React hooks (useState, useEffect, useCallback)
- API calls: Dùng axios, handle error

CODE REVIEW
-----------
- Code phải clean, dễ đọc
- Comment code phức tạp
- Không hardcode, dùng constants
- Reuse components khi có thể
- Performance: Tối ưu re-render, lazy load
- Security: Không expose sensitive data

TESTING
-------
- Test trước khi commit
- Test các trường hợp lỗi
- Test trên device thật (nếu có)
- Test với data thật

COMMUNICATION
-------------
- Nếu gặp vấn đề: Hỏi leader trước khi code
- Nếu thấy bug: Báo ngay cho leader
- Nếu hoàn thành: Báo leader để review
- Nếu cần help: Hỏi leader hoặc thành viên khác

==========================================
KẾT THÚC TÀI LIỆU
==========================================

